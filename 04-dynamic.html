<!DOCTYPE html>
<html>
<head>
    <title>Author Carpentry</title>
    <link rel="stylesheet" href="css/site.css">
</head>
<body>
<header>
<a href="http://authorcarpentry.github.io"><img src="img/AClogo.jpg" alt="Author Carpentry logo"></a>
</header>
<nav>
<ul>
<li><a href=".">Lesson</a></li>
<li><a href="01-getting-started.html">Day 1: Getting Started</a></li>
<li><a href="02-markdown.html">Day 2: Intro to Markdown</a></li>
<li><a href="03-modifying-appearance.html">Day 3: Document Appearance</a></li>
<li><a href="04-dynamic.html">Day 4: Dynamic Documents</a></li>
<li><a href="05-publishing.html">Day 5: Publishing</a></li>
<li><a href="mailto:authorcarpentry@library.caltech.edu">Contact Us</a></li>
</ul>

</nav>

<section>
<h1>Dynamic Content in the Reproducible Report</h1>

<p>3 hours</p>

<hr />

<p>In a reproducible report, elements in the <code>Rmarkdown</code> file affect not only how your documents look, but also how they render and behave when output to a final format. That is because the coded text and scripts within the <code>Rmarkdown</code> file are <strong>computationally actionable</strong>. A computer is operating on the document to combine and render its content, providing you more power than you would have working manually as a human author.</p>

<p>In this lesson we&rsquo;ll add a set of dynamic features to the exercise file and knit it to evaluate the outputs in HTML and Word.</p>

<h2>Learning Objectives</h2>

<ul>
<li>Integrate dynamic content from an <code>R</code> script so the output is continually updated</li>
<li>Distinguish between dynamic elements that will (and won&rsquo;t) work in multiple output formats (HTML, Word)</li>
<li>Add an HTML widget to allow user interaction in an output HTML document</li>
<li>Parameterize a document to permit efficient and powerful customized HTML reports</li>
<li>Demonstrate the power of integrating content from the Web into your reproducible report</li>
</ul>

<hr />

<h2>Content generated from <code>R</code> scripts</h2>

<p>Up to now, you have manually entered three dates referenced in this document. Let&rsquo;s replace them with dynamically generated dates that will auto-update by the computer!</p>

<ol>
<li>Open the file <code>insert_4a_dates.R</code><br /></li>
<li>Copy the code into the 3 different sections of the exercise file, as directed in the comments included in<code>insert_4a_dates.R</code><br /></li>
<li>Close the file <code>insert_4a_dates.R</code></li>
</ol>

<p>Another section of the exercise file that can be populated by the computer is the number of journals in the <em>DOAJ Seal</em> dataset. Let&rsquo;s replace manually-composed text with computer code!</p>

<ol>
<li>Open the file <code>insert_4a_jnls.txt</code></li>
<li>Copy the code into the <strong>Data being collected</strong> section of the exercise file, making it the first sentence.</li>
<li>Close the file <code>insert_4a_jnls.txt</code></li>
</ol>

<p>Save the changes to the exercise file and knit to HTML and Word. Can you find the dynamically-generated inline text now?</p>

<h2>Auto-generate bibliography files</h2>

<p>Have you wondered why the YAML in the exercise file contains two separate bibliography files (<code>oajournals.bib</code> and <code>packages.bib</code>)? Why not make one concatenated file?</p>

<p>The reason for the two files is that some of the references cited in our reproducible report represent <code>R</code> packages used to generate the report. <code>R</code> packages are continually updated in the <a href="https://cran.r-project.org/">The Comprehensive R Archive Network, CRAN</a>. If we manually maintained the bibliography file we&rsquo;d be editing it continually to reflect the new version of any <code>R</code> package we use.</p>

<p>Alternatively, we can use the <code>write_bib.R</code> function in <code>knitr</code> to dynamically generate a <code>packages.bib</code> file for all the <code>R</code> packages referenced in the report. This more powerful and efficient form of literature programming provides certainty that the references are always up-to-date!</p>

<p>In this exercise, let&rsquo;s add the citation for the <code>DT</code> and the  <code>rorcid</code> packages that we&rsquo;ll be using later on in this lesson.</p>

<ol>
<li>Open <code>packages.bib</code> file to see that it currently does not include a citation for <code>DT</code> or <code>rorcid</code>. Close that file.</li>
<li>Open the script file <code>write_bib.R</code> and on the third line &ndash; the one that starts with <code>write_bib(c(&quot;tidyverse&quot;...)</code> add <code>DT</code> and <code>rorcid</code>, each in quotes, to the list of packages you want references for.</li>
<li>Save the changes to <code>write_bib.R</code></li>
<li>Select all of the code in  <code>write_bib.R</code> with your mouse. Once it is all highlighted, press <code>command+enter</code> to execute the code. You can watch the code run in your console window.</li>
<li>Open <code>packages.bib</code> file once again to see that it now includes a citation for the <code>DT</code> and <code>rorcid</code> packages we&rsquo;ll be using in a bit. Close that file and put a smiley sticky on your laptop to signify happiness.</li>
</ol>

<h2>Building in User Interaction (Part 1)</h2>

<p><code>Rmarkdown</code> offers multiple ways to build in user interactivity into your reproducible report. Enhancing documents in this way allows readers of your report to interact with, inspect, and evaluate the data and code you&rsquo;ve published.</p>

<p>Let&rsquo;s start by adding a <code>code folding</code> option in our HTML output. This small interactive feature allows readers to see or hide the code chunks embedded in your report.</p>

<ol>
<li>In the YAML header of the exercise file, add a new line below the <code>output:</code> and <code>html:</code> lines.</li>
</ol>

<p><code>code_folding: hide</code></p>

<p>This line should be at the same indent as other html options such as <code>css</code>, <code>toc</code>, <code>number_sections</code>, etc.</p>

<ol>
<li>Save the changes to the exercise file and knit to HTML and Word.</li>
</ol>

<p>What difference do you see in how <code>code folding</code> renders in the HTML and Word outputs? You can ponder this question as you enjoy a morning break!</p>

<hr />

<h2>Building in User Interaction (Part 2)</h2>

<p>The data underlying this report is a table showing <em>DOAJ Seal</em> journals as rows, and the characteristics of those data as the columns. Let&rsquo;s make all of that data fully accessible and reuseable for the readers of this report.</p>

<p>To accomplish this enhancement, we need to copy a code chunk that formats the underlying dataset using the <code>Datatable (DT)</code> package. [@R-DT].  This package is one of the <a href="https://www.htmlwidgets.org/">HTML Widgets</a> that enable JavaScript libraries to create dynamic content in <code>Rmarkdown</code> documents. <code>DT</code> tables and other HTML Widgets are not covered in this course. However we can insert a pre-built data table in our reproducible report to illusthate the power of interactive features !</p>

<ol>
<li><p>Open the <code>R</code> script <code>insert_4b_DTtable.R</code> and copy all of the code with your mouse. Close the file.</p></li>

<li><p>In the exercise file, scroll down to the <strong>Annexes</strong> heading and paste in the code chunk. Save the change and knit the document to HTML to see the dynamic data table generated in your report.</p></li>

<li><p>Now let&rsquo;s tidy up this section of the report by adding a heading above this data table and a link to the static version of the table (higher up in the exercise file).</p></li>
</ol>

<ul>
<li><p>Open the file <code>insert_4b_table.txt</code> and copy the first line of text (marked with a ## header). Keep this file open because we will return to it to copy the second paragraph of text shortly&hellip;</p></li>

<li><p>In the exercise file, paste the copied text under the heading <strong>Annexes</strong> and above the data-table code chunk.</p></li>

<li><p>Back in the file <code>insert_4b_table.txt</code>, copy the second paragraph of text starting with &ldquo;The complete data set&hellip;&rdquo;</p></li>

<li><p>In the exercise file, scroll up to the section <strong>Existing Data Being Reused</strong> where the table <strong>A Table of the first 4 rows of the DOAJ Seal data</strong> is displayed. Immediately after the text sentence &ldquo;A sample of the <code>doaj_seal.csv</code> data set is shown below&rdquo;, paste in the copied text. You should now have the following paragraph located above the static table.</p></li>
</ul>

<blockquote>
<p>A sample of the <code>doaj_seal.csv</code> data set is shown below.  The complete data set is available in searchable and  broweseable format as <a href="#annex-table">Annex 10.1</a> at the end of this document.</p>
</blockquote>

<ul>
<li>Test the link to Annex 10.1 to move between the static table and the dynamic one. Now you know how to build in links to different sections within an Rmarkdown document.</li>
</ul>

<h2>Adding Parameters to a Report</h2>

<p>Another dynamic feature of Rmarkdown reports is the ability to add parameters that allow the report to be customized  before knitting. In the words of @Xie_2018:</p>

<blockquote>
<p>One of the many benefits of working with R Markdown is that you can reproduce analysis at the click of a button. This makes it very easy to update any work and alter any input parameters within the report. Parameterized reports extend this one step further, and allow users to specify one or more parameters to customize the analysis. This is useful if you want to create a report template that can be reused across multiple similar scenarios. Examples may include:</p>

<blockquote>
<ul>
<li>Showing results for a specific geographic location.</li>
<li>Running a report that covers a specific time period.</li>
<li>Running a single analysis multiple times for different assumptions.</li>
</ul>
</blockquote>
</blockquote>

<p>Let&rsquo;s parameterize our exercise file to demonstrate the power of this dynamic reporting feature!  We&rsquo;ll apply this feature to enable the author to select her/his Institution, a parameter that appears several times in the document. We wil need to add some new code to the YAML header as well as to several paragraphs where the Institution has been hard-coded.</p>

<ol>
<li><p>Open the file <code>insert_4b_params.txt</code> and copy all of the code. Close the file.</p></li>

<li><p>In the YAML header at the bottom (before the three ending dashes), paste in the copied code. If you wish to change the names of any of the Institutions listed, feel free to do so. Just make sure there are at least four Institutions included in the list. Save the changes.</p></li>

<li><p>Now replace all occurrences of a hard-coded Institution name with code that will be populated by the parameter selected at knit time. The first occurrence is in the YAML Header. To find the occurrences in the main body of the text, use the <code>Find</code> option under <code>RStudio</code>&rsquo;s Edit menu.</p></li>
</ol>

<p>The code to insert is <code>r params$institution</code>.</p>

<h2>Pull from an ORCID profile</h2>

<p>In order to dynamically pull from an ORCID profile, we have to get an
authentication token from ORCID.  In the document find the section called
&lsquo;Principal Investigators Biosketch&rsquo;.  We&rsquo;ll be doing a three step process to
connect our document with our ORCID account.</p>

<p>Open the file <code>insert_4b_orcid.R</code>. Copy the first code chunk to the &lsquo;Principal
Investigators Biosketch&rsquo; section of your document.</p>

<p>Click the green arrow to run the code
chunk.  This will open up a web browser to the ORCID web site, where you&rsquo;ll log
in as normal.  In your R environment you&rsquo;ll see a variable called &lsquo;token&rsquo;.
This is what provides access to ORCID.</p>

<p>In the R console type <code>token</code>.  This will print the token value to the console.
Next copy and paste the following code chunk:</p>

<pre><code>if(!file.exists(&quot;~/.Renviron&quot;)) # only create if not already there
  file.create(&quot;~/.Renviron&quot;)    # (don't overwrite it)
file.edit(&quot;~/.Renviron&quot;)
</code></pre>

<p>This will open up a text file in Rstudio.  In this file you&rsquo;ll want to type</p>

<pre><code>ORCID_TOKEN=&quot;1c7...&quot;
</code></pre>

<p>where <code>1c7...</code> is replaced by the long string that we printed to the R console
earlier.  You&rsquo;ll want to copy everything after <code>BEARER</code>. Save this file, which
will be read every time you use R.  This file will show up in your home
directory, which is different from your current directory.</p>

<p>Now go back to the document.  Edit the text to say &lsquo;This is auto-populated..&rsquo;
and then add the text &lsquo;<code>r bio</code>&rsquo; which will place your bio in the
document.  Then knit and you&rsquo;ll see your biography from ORCID in the document.</p>

<p>Now go to your ORCID account and make a change to your biography.  Now all you need to update the
biosketch in your document is to click the knit button.</p>

<p>Previous: <a href="00-getting-started.html">Getting Started with Markdown</a> Next: <a href="02-gh-pages.html">Github Pages</a></p>

</section>

<footer>
<span>&copy; Lesson Contributors</span>
<span><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img
alt="Creative Commons License" style="vertical-align: middle;"
src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a></span>
<span>This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution
4.0 International License</a></span>
</footer>
</body>
</html>
